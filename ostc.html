<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bring Native to the Web: an introduction to Emscripten and asm.js</title>
  <meta name="author" content="张频 (Pin Zhang)">

  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

  <link rel="stylesheet" href="css/reveal.css">
  <link rel="stylesheet" href="css/theme/sky.css" id="theme">

  <!-- Code syntax highlight -->
  <link rel="stylesheet" href="lib/css/zenburn.css">

  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
  </script>

  <style type="text/css">
  code {
    padding: 0.5rem 0 !important;
  }

  td {
    padding: 0 !important;
  }

  strong {
    color: #41C;
  }

  .reveal h1, .reveal h2, .reveal h3, .reveal h4, .reveal h5, .reveal h6 {
    text-transform: none !important;
    font-weight: bold;
  }

  .reveal h1, .reveal h2, .reveal h3 {
    color: #369;
  }

  .reveal section img {
    border: none;
    box-shadow: none;
  }

  /* styles for line number */
  pre {
    counter-reset: lines;
  }
  pre .line {
    counter-increment: lines;
  }
  pre .line::before {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;

    -o-user-select: none;
    user-select: none;

    content: counter(lines); text-align: right;
    display: inline-block; width: 2em;
    padding-right: 0.5em; margin-right: 0.5em;
    color: #BBB; border-right: solid 1px;
  }
  pre.nolinenumber .line::before {
    content: unset !important;
  }
  </style>
  <!--[if lt IE 9]>
  <script src="lib/js/html5shiv.js"></script>
  <![endif]-->
</head>
<body>
  <div class="reveal">
    <div class="slides">
      <section>
        <h2>Bring Native to the Web</h2>
        <h4>An introduction to Emscripten and asm.js</h4>
        <h4>张 频</h4>
        <p>
          <small>pzhang@mozilla.com</small>
        </p>
        <p>
          <img width="20%" src="mozilla_wordmark.png" />
        </p>
      </section>
      <section>
        <h2>Outline</h2>
        <ul>
          <li>What is Emscripten and asm.js?</li>
          <li>Performance comparison and demos</li>
          <li>Emscriptem tutorial</li>
          <li>Connecting C/C++ and Javascript</li>
          <li>Limitations</li>
        </ul>
      </section>
      <section>
        <h2>About Mozilla</h2>
        <p>Non-profit orgnization</p>
        <p>Our <b>mission</b> is to promote <b>openness</b>, <b>innovation</b> &amp; <b>opportunity</b> on the Web</p>
        <p>1000+ employees in 15 countries</p>
        <p>500+ million users</p>
        <img src="firefox-products.png">
      </section>
      <section>
        <section>
          <h3>What is Emscriptem and asm.js?</h3>
        </section>
        <section>
          <h3>About Emscripten</h3>
          <p>An open source LLVM to Javascript compiler</p>
          <p>Complie C/C++ code into Javascript</p>
          <p>C/C++ <ruby>----<rt><strong>clang</strong></rt></ruby>&gt; llvm <ruby>------<rt><strong>Fastcomp</strong></rt></ruby>&gt; javascript</p>
          <p>Execute at close to native speed</p>
          <p>Use standard web technologies</p>
          <p>Integrated into Unity3D, Unreal Engine etc.</p>
          <p>Created by <a target="_blank" href="https://www.mozilla.org/">Mozilla</a></p>
        </section>
        <section>
          <h3>Why Emscripten?</h3>
          <p>Lots of powerful and stable tools in the native world</p>
          <p>Rewritting in JS is time consuming or even impossible</p>
          <p>Running on the web!</p>
          <p>Your apps can reach all the platforms</p>
          <p>Execute at close to native speed</p>
          <p>Javascript engines are highly optimized and getting faster</p>
        </section>
        <section>
          <h3>asm.js</h3>
          <p>A low-level subset of Javascript, easy to be optimized (AOT)</p>
          <p>Enabled by prologue directive like strict mode</p>
          <pre><code class="javascript linenodes" contenteditable>// Sample codes in asm.js
function asmCode(global, env, buffer) {
  'use asm';
  var HEAP = new global.Uint8Array(buffer);
  function fib_like(x) {
    x = x|0;
    if ((x &gt;&gt;&gt; 0) &lt; 2) return HEAP[x]|0;
    return ((fib_like((x-2)|0)|0) + (fib_like((x-1)|0)|0))|0;
  }
  return fib_like;
}         </code></pre>
          <p></p>
          <p><strong>HEAP</strong> is a virtual heap as <strong>typed arrays</strong></p>
          <p><strong>|0</strong> trick ensures 32-bit ints</p>
        </section>
        <section>
          <h3>asm.js cont.</h3>
          <p>Sample C code</p>
          <pre><code contenteditable>// sample c code
int increase(int a) {
  return a + 1;
}       </code></pre>
        <p>Compiled Javascript code</p>
        <pre><code contenteditable>// generated asm.js code
function _increase(a){
  a=a|0;
  return a+1|0
}         </code></pre>
        </section>
      </section>
      <section>
        <section>
          <h3>Performance comparison and demos</h3>
        </section>
        <section>
          <h3>Demos</h3>
          <p>Running <a target="_blank" href="http://pinzhang.github.io/emscripten-python/index.html">Python</a> and <a href="http://kripken.github.io/lua.vm.js/repl.html" target="_blank">Lua</a> in web page.</p>
          <p><a href="http://kripken.github.io/box2d.js/webgl_demo/box2d.html">Box2D</a></p>
          <p>Angry Bots</p>
          <p>
            <a href="http://beta.unity3d.com/jonas/AngryBots/" target="_blank"><img src="angrybots.png"></a>
            <a href="http://beta.unity3d.com/jonas/DT2/" target="_blank"><img src="DEAD-TRIGGER.png"></a>
          </p>
          <p><a target="_blank" href="https://github.com/kripken/emscripten/wiki/Porting-Examples-and-Demos">Here</a> are more examples and demos</p>
        </section>
        <section>
          <h3>asm.js Performance - Box2D</h3>
          <a href="box2d_benchmark.png"><img src="box2d_benchmark.png"></a>
          <small>source: <a href="https://twitter.com/jgw">@jgw</a>, <a href="http://www.j15r.com/blog/2014/05/23/Box2d_2014_Update">Box2D 2014 Update</a>; axis is time slower than native, lower is better</small>
          <p>
            asm.js is <strong>faster</strong> than "typical" JavaScript (<strong>Box2dWeb</strong>) on Internet Explorer, Chrome and Firefox
          </p>
        </section>
        <section>
          <h3>asm.js Performance - Unity3D</h3>
          <a href="unity3D_benchmarks.png"><img width="100%" src="unity3D_benchmarks.png"></img></a>
          <small>Run on 15” Retina MacBook Pro 2.6 GHz i7 running OS X 10.10</small>
          <small>Source: <a href="http://blogs.unity3d.com/cn/2014/10/07/benchmarking-unity-performance-in-webgl/" target="_blank">http://blogs.unity3d.com/cn/2014/10/07/benchmarking-unity-performance-in-webgl/</a></small>
        </section>
      </section>
      <section>
        <section>
          <h3>Emscripten tutorial</h3>
        </section>
        <section>
          <h3>Emscripten toolchain</h3>
          <p>
            <a href="http://kripken.github.io/emscripten-site/docs/introducing_emscripten/about_emscripten.html?highlight=emscripten%20toolchain#emscripten-toolchain" target="_blank"><img src="EmscriptenToolchain.png"></a>
          </p>
        </section>
        <section>
          <h3>Emscripten tutorial - download and install</h3>
          <p>Download emsdk, install and activate the latest branch</p>
          <p>
            <small><a href="http://kripken.github.io/emscripten-site/docs/getting_started/downloads.html">http://kripken.github.io/emscripten-site/docs/getting_started/downloads.html</a></small>
          </p>
          <pre class="fragment"><code contenteditable>$ cd $EMSDK_HOME/</code></pre>
          <pre class="fragment"><code contenteditable>$ ./emsdk update</code></pre>
          <pre class="fragment"><code contenteditable>$ ./emsdk install latest</code></pre>
          <pre class="fragment"><code contenteditable>$ ./emsdk activate latest</code></pre>
          <pre class="fragment"><code contenteditable>$ source ./emsdk_env.sh</code></pre>
        </section>
        <section>
          <h3>Emscripten tutorial cont.</h3>
          <p>Compile test codes in the SDK</p>
          <pre><code contenteditable>// $EMSDK/emscripten/lastest/tests/hello_world.c
#include&lt;stdio.h&gt;
int main() {
  printf("hello, world!\n");
  return 0;
}         </code></pre>
          <pre class="fragment"><code contenteditable>$ cd $EMSDK/emscripten/latest
$ ./emcc tests/hello_world.c </code></pre>
          <p class="fragment">Run generated code in node.js</p>
          <pre class="fragment"><code contenteditable>$ node a.out.js</code></pre>
          <p class="fragment">Generate and run code in browser</p>
          <pre class="fragment"><code contenteditable>$ ./emcc tests/hello_world.c -o hello_world.html</code></pre>

          <aside class="notes">Demo in real console.</aside>
        </section>
        <section>
          <h3>Inside the generated code</h3>
          <p>Most of the codes are framework and libraries</p>
          <p>9k+ codes are generated (unoptimized)</p>
          <p>Code size: 350k, zipped size: 84K</p>
          <pre><code contenteditable>$ ./emcc -O2 --closure 1 tests/hello_world.c</code></pre>
          <p>Code size: 85K, zipped size: 83k</p>
          <pre><code contenteditable>// Generated Javascript codes with `-O1`
function _main() {
 var label = 0, sp = 0; 
 sp = STACKTOP;
 (_puts((8|0))|0);
 STACKTOP = sp;return 0;
}         </code></pre>
          <p></p>
        </section>
        <section>
          <h3>Emscripten Runtime Environment</h3>
          <p>Implemented <strong>libc</strong> and <strong>libcxx</strong> and a virtual file system</p>
          <p>Default file system <strong>MEMFS</strong> stores files in-memory</p>
          <p><strong>IDBFS</strong> could be mounted to persist the data</p>
          <p><strong>NODEFS</strong> could be mounted access the real files</p>
          <p>Implemented Simple DirectMedia Layer API (<strong>SDL</strong>)</p>
          <p><small>provides low level access to audio, keyboard, mouse, joystick, and graphics hardware</small></p>
        </section>
      </section>
      <section>
        <section>
          <h3>Connecting C++ and Javascript</h3>
        </section>
        <section>
          <h3>Connecting C++ and Javascript</h3>
          <p class="fragment">Call compiled C from Javascript</p>
          <aside class="notes">How to use the compiled lib in JS.</aside>
          <p class="fragment">
            C++ binding
            <br/>
            <small>name mangling</small>
          </p>
          <aside class="notes">C++ name mangling, use compiled C++ codes in the OO way</aside>
          <p class="fragment">Call Javascript from C/C++
            <small>There are thoundsands of browser native APIs, geolocation, webrtc etc.</small>
          </p>
          <aside class="notes">Call JS native APIs for the sake of performance and code size</aside>
        </section>
      </section>
      <section>
        <section>
          <h3>Part I: Call compiled C functions from JS</h3>
        </section>
        <section>
          <h3>Call compiled C function from JS</h3>
          <p>C code</p>
          <pre><code contenteditable>// int_sqrt.c
#include &lt;math.h&gt;
int int_sqrt(int x) {
    return sqrt(x);
}       </code></pre>
          <p>Compile to Javascript</p>
          <pre><code contenteditable>$ emcc int_sqrt.c -s EXPORTED_FUNCTIONS="['_int_sqrt']" </code></pre>
          <small>We need <strong>-s EXPORTED_FUNCTIONS</strong> to keep functions from being optimized.</small>
        </section>
        <section>
          <h3>Call `int_sqrt` from Javascript</h3>
          <p>cwrap</p>
          <pre><code contenteditable>// Javascript
var int_sqrt = Module.cwrap('int_sqrt', 'number', ['number'])
var result = int_sqrt(12); </code></pre>
          <p>ccall</p>
          <pre><code contenteditable>// Javascript
var result = Module.ccall(
  'int_sqrt', // name of C function
  'number',   // return type
  ['number'], // argument types
  [28]);      // arguments   </code></pre>
        </section>
      </section>
      <section>
        <section>
          <h3>Part II: C++ binding, <strong>WebIDL Binder</strong></h3>
        </section>
        <section>
          <h3>C++ binding - <strong>WebIDL Binder</strong></h3>
          <p>A lightweight approach to <strong>binding</strong> C++</p>
          <p>Use <strong><a target="_blank" href="http://www.w3.org/TR/WebIDL/">WebIDL</a></strong> to define bindings</p>
          <p>Support <strong>subset</strong> of C++ types that can be expressed in WebIDL</p>
          <p>This subset is more than <strong>sufficient</strong> for most use cases</p>
          <p>Have been used in porting <strong><a target="_blank" href="https://github.com/kripken/box2d.js/#box2djs">Box2D</a></strong> and <strong><a target="_blank" href="https://github.com/kripken/ammo.js/#ammojs">Bullet</a></strong></p>
        </section>
        <section>
          <h3>WebIDL Binder</h3>
          <table style="width: 100%; margin-left: auto; margin-right: auto;">
            <tr width="100%">
              <td width="50%" style="text-align: center">foobar.h</td>
              <td style="text-align: center">foobar.webidl</td>
            </tr>
            <tr>
              <td><pre><code contenteditable>class Foo {
private:
  int value;
public:
  int getValue();
  void setValue(int value);
};

class Bar {
private:
  long value;
public:
  Bar(long value);
  void doSomething();
};            </code></pre></td>
              <td><pre><code contenteditable>// foobar.webidl
interface Foo {
  void Foo();
  long getValue();
  void setValue(long value);
};

interface Bar {
  void Bar(long v);
  void doSomething();
};             </code></pre></td>
            </tr>
          </table>
          <p><small>There is no `int` in WebIDL, use `long` instead, <a target="_blank" href="http://kripken.github.io/emscripten-site/docs/porting/connecting_cpp_and_javascript/WebIDL-Binder.html#webidl-types">here</a> is detailed type mapping</small></p>
          <p></p>
        </section>
        <section>
          <h3>WebIDL Binder</h3>
          <p>Generate glue codes</p>
          <pre><code contenteditable>$ cd $EMSDK/emscripten/lastest
$ python tools/webidl_binder.py foobar.webidl  </code></pre>
          <small><strong>glue.cpp</strong> and <strong>glue.js</strong> are generated</small>
          <p><strong>#include</strong> the headers you are binding and <strong>glue.cpp</strong></p>
          <pre><code contenteditable>// glue_wrapper.cpp
#include "foobar.h"
#include "glue.cpp"  </code></pre>
          <p>Compile them together</p>
          <pre><code contenteditable>$ emcc foobar.cpp glue_wrapper.cpp --post-js glue.js -o foobar.js </code></pre>
        </section>
        <section>
          <h3>Using C++ classes in Javascript</h3>
          <pre><code contenteditable>var foo = new Module.Foo();
foo.setValue(100);
console.log(foo.getValue());

var bar = new Module.Bar();
bar.doSomething(); </code></pre>
          <p>Destroy the object if needed, i.e. C++ class have destructor</p>
          <pre><code contenteditable>Module.destroy(foo);
Module.destroy(bar); </code></pre>
        </section>
        <section>
          <h3>WebIDL Binder</h3>
          <p>Sub-classing C++ base classes in JS</p>
          <p>Use JSImplementation in WebIDL</p>
          <pre><code contenteditable>// `Base` is the C++ class
[JSImplementation="Base"]
interface ImplJS {
        void ImplJS();
        void virtualFunc();
};        </code></pre>
          <p>Implement the interface in JS</p>
          <pre><code contenteditable>var o = new ImplJS();
o.virtualFunc = function() { ... }; </code></pre>
          <small>When C++ code has a pointer to a Base instance and calls virtualFunc(), that call will reach the JavaScript code defined above.</small>
        </section>
      </section>
      <section>
        <section>
          <h3>Part III: <strong>Embind</strong></h3>
        </section>
        <section>
          <h3>Call compiled C++ from JS - <strong>Embind</strong></h3>
          <p>Bind C++ functions and classes to Javascript</p>
          <p>Was inspired by <strong><a target="_blank" href="http://www.boost.org/doc/libs/1_56_0/libs/python/doc/">Boost.Python</a></strong></p>
          <p>Need to add some binding declaration codes</p>
          <p>No extra tool, say WebIDL, is needed</p>
        </section>
        <section>
          <h3>Embind - binding functions</h3>
          <pre><code contenteditable>// sample.cpp
size_t cpp_strlen(std::string str) {
  return str.length();
}         </code></pre>
          <pre><code contenteditable>// say my_binding.cpp
#include &lt;emscripten/bind.h&gt;
#include "sample.h"
using namespace emscripten;
EMSCRIPTEN_BINDINGS(cpp_funcs) {
  function("cpp_strlen", &amp;cpp_strlen);
}         </code></pre>
          <small>Add binding declaration to exsiting files or a separate file</small>
        </section>
        <section>
          <h3>Compile and call from Javascript</h3>
          <p>Compile with <strong>--bind</strong></p>
          <pre style="margin-left: 0; margin-right: 0; width: 100%;"><code contenteditable>$ emcc sample.cpp my_binding.cpp --bind -EXPORTED_FUNCTIONS=["cpp_strlen"]</code></pre>
          <p>Call compiled code from Javascript</p>
          <pre style="width: 100%;"><code contenteditable>// Call compiled binding function from javascript
console.log("The length is: " + cpp_strlen("some string here")); </code></pre>
        </section>
        <section>
          <h3>Embind - binding classes</h3>
          <pre><code contenteditable>// sample.h
class ClassA {
  int value;
public:
  ClassA(int aValue);
  void setValue(int aValue);
  int getValue() const;
  static void printSomething();
};      </code></pre>
          <pre><code contenteditable>// my_bindings.cpp
#include &lt;emscripten/bind.h&gt;
#include "sample.h"
EMSCRIPTEN_BINDINGS(cpp_class) {
  class_&lt;ClassA&gt;("ClassA")
    .constructor&lt;int&gt;()
    .property("value", &amp;ClassA::getValue, &amp;ClassA::setValue)
    .class_function("printSomething", &amp;ClassA::printSomething)
    ;
}         </code></pre>
          <p></p>
        </section>
        <section>
          <h3>Embind - binding classes cont.</h3>
          <p>Compile and call from Javascript</p>
          <pre class="nolinenumber" style="margin-left: 0; margin-right: 0; width: 100%;"><code contenteditable>  $ emcc sample.cpp my_binding.cpp --bind -EXPORTED_FUNCTIONS=["cpp_strlen"]</code></pre>
          <pre style="width: 100%;"><code contenteditable>// Call from Javascript
var obj = new Module.ClassA(100);
console.log("ClassA::getValue: " + obj.getValue());
Module.ClassA.printSomething()
// The C++ object must be deleted.
sampleObj.delete(); </code></pre>
          <p>Javascript does not support <strong>finalizers</strong> or weak references with callbacks</p>
          <p>JavaScript code must explicitly <strong>delete</strong> any C++ object handles it has received, or the Emscripten heap will grow indefinitely.</p>
        </section>
        <section>
          <h3>Embind - derive from C++ classes</h3>
          <pre><code contenteditable>// sample.h
class MyInterface {
private:
  std::string name = "My Interface Name";

public:
  const std::string getName();
  virtual void invoke(const std::string&amp; str) = 0;
};        </code></pre>
          <pre><code contenteditable>// my_bindings.cpp
class MyInterfaceWrapper : public wrapper&lt;MyInterface&gt; {
public:
  EMSCRIPTEN_WRAPPER(MyInterfaceWrapper);
  void invoke(const std::string&amp; str) {
    return call&lt;void&gt;("invoke", str);
  }
};
EMSCRIPTEN_BINDINGS(cpp_interface) {
  class_&lt;MyInterface&gt;("MyInterface")
    .function("invoke", &amp;MyInterface::invoke, pure_virtual())
    .function("getName", &amp;MyInterface::getName)
    .allow_subclass&lt;MyInterfaceWrapper&gt;("MyInterfaceWrapper")
    ;
}         </code></pre>
        </section>
        <section>
          <h3>Embind - derive from C++ classes, cont.</h3>
          <p><strong>extend</strong> or <strong>implement</strong> the interface in JS</p>
          <pre><code contenteditable>// Use `extend` to subclass in Javascript
var DerivedClass = Module.Interface.extend("Interface", {
  invoke: function(str) {
    // Your code goes here
    console.log('invoking with: ' + str);
  }
});
var instance = new DerivedClass;     </code></pre>
          <pre class="fragment"><code contenteditable>// Use an object to `implement` the interface
var x = {
  invoke: function(str) {
    console.log('invoking with: ' + str);
  }
};
var interfaceObject = Module.Interface.implement(x);     </code></pre>
        </section>
      </section>
      <section>
        <section>
          <h3>Call Javascript from C/C++</h3>
        </section>
        <section>
          <h3>Call Javascript from C/C++</h3>
          <p>Direct call, but slightly slow</p>
          <pre><code contenteditable>// sample.c
#include &lt;emscripten.h&gt;
int main() {
  emscripten_run_script("alert('hi')");
}       </code></pre>
          <p>Inline Javascript by using macro <strong>EM_ASM()</strong></p>
          <pre><code contenteditable>// sample.c
#include &lt;emscripten.h&gt;
int main() {
  EM_ASM(
    alert('Hello world!');
  );
}         </code></pre>
        </section>
        <section>
          <h3>Call Javascript from C/C++, cont.</h3>
          <p>Implement a C API in JavaScript</p>
          <pre><code contenteditable>// sample.c
#include &lt;emscripten.h&gt;
// Declare function defined in Javascript
extern int js_strlen(const char* str);

int main() {
  const char* str = "string for testing";
  int len = js_strlen(str);
  printf("The length of '%s' is %d.\n", str, len);
}     </code></pre>
        <p>Make the JS implementation as part of the libraries</p>
        <pre><code contenteditable>// my_lib.js
mergeInto(LibraryManager.library, {
  js_strlen: function(str) {
    return Pointer_stringify(str).length;
  },
}         </code></pre>
        </section>
        <section>
          <h3>Call Javascript from C/C++, cont.</h3>
          <p>Compile the lib file together</p>
          <pre><code contenteditable>$ emcc sample.c --js-library lib.js</code></pre>
          <p>Run the compiled code</p>
          <pre><code contenteditable>$ node a.out.js</code></pre>
          <p>Here is the output:</p>
          <pre><code contenteditable>The length of 'string for testing' is 18.</code></pre>
        </section>
        <section>
          <h3>Call Javascript from C/C++, cont.</h3>
          <p>Use <strong>emscripten::val</strong> to transliterate JS to C++</p>
          <p><strong>emscripten::val</strong> is part of Embind</p>
          <pre style="width: 100%;"><code contenteditable>// Javascript
// Get web audio api context
var AudioContext = window.AudioContext || window.webkitAudioContext;

// Got an AudioContext: Create context and OscillatorNode
var context = new AudioContext();
var oscillator = context.createOscillator();

// Configuring oscillator: set OscillatorNode type and frequency
oscillator.type = 'triangle';
oscillator.frequency.value = 261.63; // value in hertz - middle C

// Playing
oscillator.connect(context.destination);
oscillator.start();

// All done! </code></pre>
        </section>
        <section>
          <h3>Call Javascript from C/C++, cont.</h3>
          <pre><code style="max-height: 100% !important" contenteditable>// C++
#include &lt;emscripten/val.h&gt;
#include &lt;stdio.h&gt;
#include &lt;math.h&gt;

using namespace emscripten;
int main() {
  val AudioContext = val::global("AudioContext");
  if (!AudioContext.as&lt;bool&gt;()) {
    printf("No global AudioContext, trying webkitAudioContext\n");
    AudioContext = val::global("webkitAudioContext");
  }

  printf("Got an AudioContext\n");
  val context = AudioContext.new_();
  val oscillator = context.call&lt;val&gt;("createOscillator");

  printf("Configuring oscillator\n");
  oscillator.set("type", val("triangle"));
  oscillator["frequency"].set("value", val(261.63)); // Middle C

  printf("Playing\n");
  oscillator.call&lt;void&gt;("connect", context["destination"]);
  oscillator.call&lt;void&gt;("start", 0);
  printf("All done!\n");
}       </code></pre>
        </section>
      </section>
      <section>
        <h3>Limitations</h3>
        <p class="fragment">
          Thread
          <br/>
          <small>JS has threads (web workers), but they cannot share state</small>
        </p>
        <p class="fragment">
          File System
          <br/>
          <small>All files exist in-memory</small>
        </p>
        <p class="fragment">
          Browser main loop
          <br/>
          <small>Use <em>emscripten_set_main_loop</em> to break the infinite loop</small>
        </p>
        <p class="fragment">
          Networking (non-blocking)
          <small>Socket API are implemented on top of WebSocket</small>
        </p>
        <p class="fragment">
          64-bit
          <br />
          <small>Mathematical operations are emulated and slow</small>
        </p>
      </section>
      <section>
        <h1><strong>Q & A</strong></h1>
      </section>
    </div>
    </div>
  </div>

  <script src="lib/js/head.min.js"></script>
  <script src="js/reveal.js"></script>
  <script>
    // Full list of configuration options available at:
    // https://github.com/hakimel/reveal.js#configuration
    Reveal.initialize({
    controls: true,
    progress: true,
    history: true,
    center: true,

    transition: Reveal.getQueryHash().transition || 'fade', // none/fade/slide/convex/concave/zoom

    // Optional reveal.js plugins
    dependencies: [
      { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
      { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'plugin/highlight/highlight.js', async: true, condition: function() {
          return !!document.querySelector( 'pre code' ); 
        }, callback: function() {
          hljs.initHighlightingOnLoad();
          hljs.configure({ lineNodes: true });
        }
      },
      { src: 'plugin/zoom-js/zoom.js', async: true },
      { src: 'plugin/notes/notes.js', async: true }
    ]
    });
  </script>
</body>
</html>
